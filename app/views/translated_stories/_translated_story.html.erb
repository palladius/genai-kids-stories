<div id="<%= dom_id translated_story %>">
  <p>
    <strong>Name:</strong>
    <%= translated_story.name %>
  </p>
  <p>
    <strong>translated_title (<%= waving_flag translated_story.language %>):</strong>
    <%= translated_story.translated_title %>
  </p>

  <p>
    <strong>User:</strong>
    <%= translated_story.user_id %>
    <%= translated_story.name %>
    <%= image_tag translated_story.user.avatar.variant(resize_to_limit: [50, 50]) if translated_story.user.avatar.attached? %>
  </p>

  <p>
    <strong>Story2:</strong>
    <%= translated_story.story_id %> -
    <%= link_to(translated_story.story.title, translated_story.story) %>
  </p>

  <p>
    <strong>Language:</strong>
    <%= translated_story.language %>
  </p>

  <p>
    <strong>Kid id:</strong>
    <%= translated_story.kid_id %>
    (lang = <%= translated_story.kid.favorite_language %>)
  </p>

  <p>
    <strong>Paragraph strategy:</strong>
    <%= translated_story.paragraph_strategy %>
  </p>

  <p>
    <strong>Internal notes:</strong>
    <%= translated_story.internal_notes %>
  </p>

  <p>
    <strong>Genai model:</strong>
    <%= translated_story.genai_model %>
  </p>

  <p>
    <strong>paragraphs_with_no_images:</strong>
    <b><%= translated_story.paragraphs_with_no_images.size %></b> (<%= translated_story.paragraphs_with_no_images %>)
    Call <tt class='debug' >TranslatedStory.find(<%=translated_story.id%>).fix</tt> to fix
  </p>



<% if (not @story_paragraphs.nil?) and @story_paragraphs.count > 0 %>
  <h3>ğŸ  Translated Story (<%= @story_paragraphs.count %> pars)</h3>

  <%= @story_paragraphs.count %>

  <table border="0" >
    <% @story_paragraphs.each do |sp| %>
      <%= render_working_story_paragraph(sp) %>
    <% end %>
  </table>
<% else  %>

  <h3>ğŸ‘ï¸ Paragraphs Preview</h3>

 ğŸ˜¥ @story_paragraphs is either null or empty. Let's generate them!<br/>
 @execute_now=<%=@execute_now %>

  <% if params[:execute_now] == 'true' %>
    ğŸ’» NOW: IMMEDIATE execution... generating kids of this story in the <b> <%= translated_story.paragraph_strategy %></b> strategy, with language=<%= translated_story.language %>.
    <% @translated_story.generate_polymorphic_paragraphs %>
  <%  else %>
    ğŸ’»ğŸ˜´ Enqueued a Delayed execution to 'translated_story::generate_polymorphic_paragraphs' queue... use  (<%= link_to('execute_now!', "#{request.fullpath.to_s}?execute_now=true") %> ) to generate immediately!
    <% @translated_story.delay(queue: 'translated_story::generate_polymorphic_paragraphs').generate_polymorphic_paragraphs %>
    TODO(ricc): make sure you only enqueue this ONCE based on a key (in this case, @translated_story.id should suffice)
  <%  end %>

    <% translated_story.polymorphic_paragraphs.each_with_index do |p, ix|  %>
      <p>
          ğŸ§  <%= ix+1 %>ğŸ§ 
          <span class='story' ><%= p %></span>
      </p>
    <% end  %>


  TODO. Thsi is big - going to require to move and repurpose existing ones under this one :)
  But probably they're going to be these: <tt>Story.find(self.story_id).paragraphs</tt>


  <% end  %>
</div>
