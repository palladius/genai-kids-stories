<!--
  Need multipart for attachments: https://stackoverflow.com/questions/50483901/rails-activestorage-error-messageverifier-invalidsignature
-->
<%= form_with(model: story, multipart: true) do |form| %>
  <% if story.errors.any? %>
    <div style="color: red">
      <h2><%= pluralize(story.errors.count, "error") %> prohibited this story from being saved:</h2>
      <ul>
        <% story.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>


  <div>
    <%= form.label :kid_id, style: "display: block", class: "form-label" %>
    <%#= form.text_field :kid_id %>
    <%= form.select :kid_id, options_for_select(Kid.all.map{|s|[s.nick, s.id]}, :selected => @story.kid_id ) %>
  </div>

  <div class="mb-3" >
    <%= form.label :title, style: "display: block", class: "form-label" %>
    <%= form.text_field :title, rows:"1"  , class: "form-control" %>
    <div id="titleHelpBlock" class="form-text">
      You can leave this empty. It will get autopopulated as a digest of the genai_output (once that is available)
    </div>
  </div>

  <div class="mb-3" >
    <%= form.label :genai_input, style: "display: block", class: "form-label" %>
    <%= form.text_area :genai_input , rows:"5", style: "height:100%;", class: 'w-50' %>
       <div id="genai_inputHelpBlock" class="form-text">
      This is the engine that powers it all.
      You can leave this empty, in which case it will take a randomly populated Kids Story idea.
      If you need inspiration, click on the <a href='/story_templates'>story_templates</a> (new!) link
      and come back here.
    </div>
  </div>

  <div>
    <%= form.label :genai_output, style: "display: block", class: "form-label" %>
    <%= form.text_area :genai_output , rows:"5", style: "height:100%;", class: 'w-50' %>
     <div id="genai_inputHelpBlock" class="form-text">
      This is generated by Vertex AI Palm API starting from the genai_input field.
      Sit back and enjoy the bot's creativity!
    </div>
  </div>

  <div>
    <%= form.label :genai_summary, style: "display: block", class: "form-label" %>
    <%= form.text_area :genai_summary , rows:"2", style: "height:100%;", class: 'w-50' %>
     <div id="genai_summaryHelpBlock" class="form-text">
      Same as Title. You can leave this empty and it will get autopopulated.
      My idea is that you don't touch the summary, while you edit the title as human
      in case Summary is bad or too long.
    </div>
  </div>

  <div>
    <%= form.label :internal_notes, style: "display: block", class: "form-label" %>
    <%= form.text_area :internal_notes , rows:"3", style: "height:100%;", class: 'w-50' %>
         <div id="internal_notesHelpBlock" class="form-text">
      Left for computer or Riccardo to populate. Should be merely invisible except to admins.
    </div>
  </div>

  <div>
    <%= form.label :user_id, style: "display: block", class: "form-label" %>
    <%= form.number_field :user_id %>
  </div>

  <div>
    <%= form.label :active, style: "display: block", class: "form-label" %>
    <%= form.check_box :active %>
  </div>
  <div>
    <%= form.label :score, style: "display: block", class: "form-label" %>
    <%= form.number_field :score %>
  </div>



<h4>Files</h4>

  <div>
    <%= form.label :cover_image %>
    <%= form.file_field :cover_image %>
  </div>

<div>
    <%= form.label :additional_images %>
    <%= form.file_field :additional_images, multiple: true, direct_upload: true %>
  </div>



  <div>
    <%= form.submit %>
  </div>
<% end %>
<%#= params %>
